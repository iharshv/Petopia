<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Petopia</title>
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>

    <header>
        <div class="container">
            <nav class="navbar">
                <a href="/index.html" class="logo">
                    <img src="/assets/logo-white.png" alt="Petopia Logo">
                </a>

                <div class="hamburger" onclick="toggleMenu()">
                    <i class="fas fa-bars"></i>
                </div>
                <ul class="nav-links" id="navLinks">
                    <li><a href="index.html#why-petopia">Why Petopia</a></li>
                    <li><a href="shop.html">Shop</a></li>
                    <li><a href="index.html#reviews">Reviews</a></li>
                    <li><a href="services.html">Services</a></li>
                    <li><a href="booking.html" class="btn btn-primary" style="padding: 5px 15px;">Book Appointment</a>
                    </li>
                    <li id="auth-mobile"
                        style="margin-top: 10px; border-top: 1px solid #444; padding-top: 10px; display: none;"></li>
                </ul>

                <div class="nav-right">
                    <div class="nav-contact-items">
                        <a href="tel:+919987801581"><i class="fas fa-phone-alt"
                                style="margin-right: 5px; color: var(--primary);"></i>+91 99878 01581</a>
                        <a href="https://maps.app.goo.gl/64Y1J6REaj2DGpYf6" target="_blank"
                            style="text-decoration: underline; font-size: 0.8rem;">Airoli, Navi Mumbai</a>
                    </div>
                    <div class="auth-links" style="color: white; margin-left: 15px;">
                        <a href="login.html">Login</a> <span style="color: var(--primary);">|</span> <a
                            href="register.html">Register</a>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <div class="container"
        style="padding: 6rem 0; min-height: 60vh; display: flex; align-items: center; justify-content: center;">
        <div
            style="width: 100%; max-width: 400px; background: var(--white); padding: 2rem; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); border: 1px solid #eee;">
            <h2 style="text-align: center; margin-bottom: 2rem;">Login to <span>Petopia</span></h2>
            <div id="message"
                style="display: none; padding: 10px; border-radius: 5px; margin-bottom: 1rem; text-align: center;">
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="email">Email Address</label>
                    <input type="email" id="email" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;" id="submitBtn">Login</button>
            </form>
            <script src="/api-config.js"></script>
            <script>
                function toggleMenu() {
                    const navLinks = document.getElementById('navLinks');
                    navLinks.classList.toggle('active');
                }

                // Auth Navigation Sync
                document.addEventListener('DOMContentLoaded', () => {
                    console.log('Nav version: 2.1.0');
                    const authLinks = document.querySelector('.auth-links');
                    const authMobile = document.getElementById('auth-mobile');
                    const token = localStorage.getItem('token');
                    const role = localStorage.getItem('userRole');

                    if (token) {
                        // Desktop
                        if (authLinks) {
                            let html = `<a href="profile.html">Profile</a>`;
                            if (role === 'admin') {
                                html += ` <span style="color: var(--primary);">|</span> <a href="admin.html">Admin Panel</a>`;
                            }
                            html += ` <span style="color: var(--primary);">|</span> <a href="#" onclick="handleLogout()">Logout</a>`;
                            authLinks.innerHTML = html;
                        }

                        // Mobile
                        if (authMobile) {
                            authMobile.style.display = 'block';
                            let html = `<a href="profile.html">Profile</a>`;
                            if (role === 'admin') {
                                html += ` | <a href="admin.html">Admin Panel</a>`;
                            }
                            html += ` | <a href="#" onclick="handleLogout()">Logout</a>`;
                            authMobile.innerHTML = html;
                        }
                    }
                });

                function handleLogout() {
                    localStorage.clear();
                    window.location.reload();
                }

                document.getElementById('loginForm').addEventListener('submit', async function (e) {
                    e.preventDefault();

                    const messageDiv = document.getElementById('message');
                    const submitBtn = document.getElementById('submitBtn');

                    submitBtn.textContent = 'Logging in...';
                    submitBtn.disabled = true;

                    const apiUrl = (window.API_BASE_URL || '') + '/api/login';

                    try {
                        console.log('Logging in at:', apiUrl);
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                email: document.getElementById('email').value,
                                password: document.getElementById('password').value
                            })
                        });

                        let data;
                        const contentType = response.headers.get("content-type");
                        if (contentType && contentType.indexOf("application/json") !== -1) {
                            data = await response.json();
                        } else {
                            const text = await response.text();
                            throw new Error('Server returned non-JSON response: ' + text.substring(0, 100));
                        }

                        if (data.success) {
                            localStorage.setItem('isLoggedIn', 'true');
                            localStorage.setItem('token', data.token);
                            localStorage.setItem('userName', data.user.name);
                            localStorage.setItem('userEmail', data.user.email);
                            localStorage.setItem('userRole', data.user.role);

                            messageDiv.style.display = 'block';
                            messageDiv.style.background = '#e6ffe6';
                            messageDiv.style.color = '#008000';
                            messageDiv.textContent = 'Login successful! Redirecting...';
                            setTimeout(() => window.location.href = 'shop.html', 1000);
                        } else {
                            messageDiv.style.display = 'block';
                            messageDiv.style.background = '#ffe6e6';
                            messageDiv.style.color = '#cc0000';
                            messageDiv.textContent = data.error || 'Login failed';
                            submitBtn.textContent = 'Login';
                            submitBtn.disabled = false;
                        }
                    } catch (error) {
                        console.error('Login fetch error:', error);
                        messageDiv.style.display = 'block';
                        messageDiv.style.background = '#ffe6e6';
                        messageDiv.style.color = '#cc0000';
                        messageDiv.textContent = 'Login Error: ' + error.message;
                        submitBtn.textContent = 'Login';
                        submitBtn.disabled = false;
                    }
                });
            </script>
            <p style="text-align: center; margin-top: 1rem; font-size: 0.9rem;">
                Don't have an account? <a href="register.html" style="color: var(--primary); font-weight: 600;">Register
                    here</a>
            </p>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-grid">
                <div>
                    <h3>Petopia</h3>
                    <p>Your one-stop shop for all things pet.</p>
                    <div style="margin-top: 1rem;">
                        <p><i class="fas fa-map-marker-alt"></i> <a href="https://maps.app.goo.gl/64Y1J6REaj2DGpYf6"
                                target="_blank" style="color: #bbb;">Yash Paradise, Shop No 30, Sector 8A, Airoli, Navi
                                Mumbai - 400708</a></p>
                        <p><i class="fas fa-phone"></i> +91 9987801581 | +91 9867120142 | +91 8169223723</p>
                        <p><i class="fas fa-envelope"></i> connectpetopia@gmail.com</p>
                    </div>
                </div>
                <div>
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="services.html">Services</a></li>
                        <li><a href="booking.html">Book Appointment</a></li>
                        <li><a href="career.html">Careers</a></li>
                    </ul>
                </div>
                <div>
                    <h3>Information</h3>
                    <ul>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="contact.html">Contact Us</a></li>
                        <li><a href="terms.html">Terms & Conditions</a></li>
                        <li><a href="privacy.html">Privacy Policy</a></li>
                    </ul>
                </div>
            </div>
            <div
                style="text-align: center; margin-top: 3rem; border-top: 1px solid #333; padding-top: 1rem; font-size: 0.8rem; color: #888; display: flex; justify-content: center; align-items: center; gap: 10px;">
                <span>&copy; 2026 Petopia. All rights reserved.</span>
                <span
                    style="background: #333; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem;">v2.1.1-deployed</span>
            </div>
        </div>
    </footer>

    <script>
        function toggleMenu() {
            const navLinks = document.getElementById('navLinks');
            navLinks.classList.toggle('active');
        }

        // Auth Navigation Sync
        document.addEventListener('DOMContentLoaded', () => {
            const authLinks = document.querySelector('.auth-links');
            const authMobile = document.getElementById('auth-mobile');
            const token = localStorage.getItem('token');
            const role = localStorage.getItem('userRole');

            if (token) {
                // Desktop
                if (authLinks) {
                    let html = `<a href="profile.html">Profile</a>`;
                    if (role === 'admin') {
                        html += ` <span style="color: var(--primary);">|</span> <a href="admin.html">Admin Panel</a>`;
                    }
                    html += ` <span style="color: var(--primary);">|</span> <a href="#" onclick="handleLogout()">Logout</a>`;
                    authLinks.innerHTML = html;
                }

                // Mobile
                if (authMobile) {
                    authMobile.style.display = 'block';
                    let html = `<a href="profile.html">Profile</a>`;
                    if (role === 'admin') {
                        html += ` | <a href="admin.html">Admin Panel</a>`;
                    }
                    html += ` | <a href="#" onclick="handleLogout()">Logout</a>`;
                    authMobile.innerHTML = html;
                }
            }
        });

        function handleLogout() {
            localStorage.clear();
            window.location.reload();
        }
    </script>
</body>

</html>